<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#1a3a6e">
<meta name="description" content="2025년 생명보험, 손해보험, 제3보험 자격시험 대비 무료 모의고사. 2000개 이상 기출문제와 해설, 학습모드·시험모드, 오답노트, 북마크 기능 제공.">
<meta name="keywords" content="보험 모의고사, 생명보험 기출문제, 손해보험 기출문제, 제3보험, 보험 자격시험, 보험설계사 시험, 보험이론, 보험법규">
<meta property="og:type" content="website">
<meta property="og:title" content="보험 모의고사 - 생명·손해·제3보험 기출문제 학습">
<meta property="og:description" content="2025년 생명보험·손해보험 자격시험 대비 무료 모의고사. 2000개 이상 기출문제, 해설, 오답노트 제공.">
<meta property="og:url" content="https://insu-two.vercel.app">
<meta property="og:locale" content="ko_KR">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://insu-two.vercel.app">
<meta name="apple-mobile-web-app-title" content="보험 모의고사">
<link rel="apple-touch-icon" id="touchIcon" href="data:,">
<link rel="manifest" href="manifest.json">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "보험 모의고사",
  "description": "2025년 생명보험, 손해보험, 제3보험 자격시험 대비 무료 모의고사 앱. 2000개 이상 기출문제와 상세 해설 제공.",
  "url": "https://insu-two.vercel.app",
  "applicationCategory": "EducationalApplication",
  "operatingSystem": "Web",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "KRW"
  },
  "inLanguage": "ko",
  "about": {
    "@type": "EducationalOccupationalProgram",
    "name": "보험 자격시험 준비",
    "educationalProgramMode": "online",
    "occupationalCategory": "보험설계사"
  }
}
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6687538764913740" crossorigin="anonymous"></script>
<title>보험 모의고사 - 생명·손해·제3보험 기출문제 학습</title>
<style>
:root {
  --bg: #f5f5f0;
  --paper: #ffffff;
  --text: #1a1a1a;
  --text-sub: #666;
  --border: #d0d0d0;
  --accent: #1a3a6e;
  --accent-light: #e8eef6;
  --correct: #0d6a3a;
  --correct-bg: #e6f4ed;
  --wrong: #c62828;
  --wrong-bg: #fde8e8;
  --font: 'Apple SD Gothic Neo', -apple-system, 'Malgun Gothic', sans-serif;
}
.damage {
  --accent: #2e6b4f;
  --accent-light: #e6f4ed;
}
.dark {
  --bg: #1a1a1e;
  --paper: #242428;
  --text: #e8e8e8;
  --text-sub: #999;
  --border: #444;
  --accent: #6b9eff;
  --accent-light: #1e2a40;
  --correct: #4caf80;
  --correct-bg: #1a2e22;
  --wrong: #ef5350;
  --wrong-bg: #2e1a1a;
}
.dark.damage {
  --accent: #5ec4a0;
  --accent-light: #1a2e28;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  -webkit-tap-highlight-color: transparent;
  transition: background 0.3s, color 0.3s;
  margin: 0 8px;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

/* ===== EXAM PAPER HEADER ===== */
.exam-header {
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  padding: 10px 24px 8px;
  position: sticky; top: 0; z-index: 100;
  opacity: 0.85;
}
.exam-header-top {
  display: flex; justify-content: space-between; align-items: center;
}
.exam-title {
  font-size: 13px; font-weight: 600; letter-spacing: -0.3px;
  color: var(--text-sub);
}
.exam-controls {
  display: flex; gap: 8px; align-items: center;
}
.ctrl-btn {
  background: none; border: 1px solid var(--border);
  border-radius: 6px; padding: 5px 10px; font-size: 12px;
  cursor: pointer; color: var(--text-sub); font-family: var(--font);
  transition: all 0.2s;
}
.ctrl-btn:hover, .ctrl-btn.active {
  background: var(--accent); color: #fff; border-color: var(--accent);
}
.back-arrow {
  background: none; border: none; font-size: 18px;
  cursor: pointer; color: var(--text-sub); padding: 4px 8px 4px 0;
  display: none;
}
.exam-section-bar {
  margin-top: 6px; font-size: 11px; color: var(--text-sub);
  display: flex; justify-content: space-between; align-items: center;
}
.section-label {
  font-weight: 600; color: var(--text-sub);
  padding: 2px 8px; background: var(--border);
  border-radius: 4px; font-size: 10px;
}
.progress-mini {
  height: 3px; background: var(--border); border-radius: 2px;
  margin-top: 6px; overflow: hidden;
}
.progress-mini-fill {
  height: 100%; background: var(--accent); border-radius: 2px;
  transition: width 0.3s;
}

/* ===== CONTAINER ===== */
.container { max-width: 560px; margin: 0 auto; padding: 0 24px; }

/* ===== HOME SCREEN ===== */
.home { padding: 20px 0 40px; }
.home-banner {
  background: var(--paper);
  border: 2px solid var(--accent);
  border-radius: 8px;
  padding: 12px; text-align: center;
  margin-bottom: 20px;
}
.home-banner h1 {
  font-size: 20px; font-weight: 800; color: var(--accent);
  margin-bottom: 4px; letter-spacing: -0.5px;
}
.home-banner p {
  font-size: 13px; color: var(--text-sub);
}
/* Mode Toggle */
.mode-bar {
  display: flex; gap: 0; margin-bottom: 16px;
  border: 1px solid var(--border); border-radius: 8px; overflow: hidden;
}
.mode-item {
  flex: 1; padding: 10px; border: none; background: var(--paper);
  font-size: 14px; font-weight: 600; cursor: pointer;
  font-family: var(--font); color: var(--text-sub);
  border-right: 1px solid var(--border);
  transition: all 0.2s;
}
.mode-item:last-child { border-right: none; }
.mode-item.active {
  background: var(--accent); color: #fff;
}

/* Category Cards */
.cat-section { margin-bottom: 20px; }
.cat-section-title {
  font-size: 13px; font-weight: 700; color: var(--text-sub);
  text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 8px; padding-left: 2px;
}
.cat-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
}
.cat-item {
  background: var(--paper);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px;
  cursor: pointer;
  transition: all 0.15s;
}
.cat-item:active { transform: scale(0.97); }
.cat-item-title {
  font-size: 14px; font-weight: 700; margin-bottom: 2px;
  color: var(--text);
}
.cat-item-sub {
  font-size: 12px; color: var(--text-sub);
}
.cat-item-bar {
  height: 3px; background: var(--border); border-radius: 2px;
  margin-top: 8px; overflow: hidden;
}
.cat-item-bar-fill {
  height: 100%; background: var(--accent); border-radius: 2px;
}

/* Mock exam list */
.mock-list {
  display: flex; flex-direction: column; gap: 6px;
}
.mock-item {
  background: var(--paper);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  cursor: pointer;
  display: flex; justify-content: space-between; align-items: center;
  transition: all 0.15s;
}
.mock-item:active { transform: scale(0.98); }
.mock-item-title { font-size: 14px; font-weight: 600; }
.mock-item-info {
  font-size: 12px; color: var(--text-sub);
  display: flex; gap: 8px; align-items: center;
}
.mock-badge {
  padding: 2px 8px; border-radius: 10px; font-size: 11px;
  font-weight: 600;
}
.mock-badge.done { background: var(--correct-bg); color: var(--correct); }
.mock-badge.partial { background: var(--accent-light); color: var(--accent); }

/* Special row */
.special-row {
  display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
  margin-bottom: 20px;
}
.special-btn {
  background: var(--paper); border: 1px solid var(--border);
  border-radius: 8px; padding: 6px 8px; text-align: center;
  cursor: pointer; transition: all 0.15s;
}
.special-btn:active { transform: scale(0.97); }
.special-btn-icon { font-size: 20px; margin-bottom: 2px; }
.special-btn-label { font-size: 12px; font-weight: 600; }
.special-btn-count { font-size: 11px; color: var(--text-sub); }

/* Options */
.options-row {
  display: flex; gap: 8px; margin-bottom: 16px;
}
.opt-btn {
  padding: 6px 14px; border-radius: 16px; font-size: 12px;
  border: 1px solid var(--border); background: var(--paper);
  cursor: pointer; font-family: var(--font); color: var(--text-sub);
  transition: all 0.2s;
}
.opt-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

/* Stats */
.stats-row {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
  margin-bottom: 20px;
}
.stat-box {
  background: var(--paper); border: 1px solid var(--border);
  border-radius: 8px; padding: 12px; text-align: center;
}
.stat-num { font-size: 24px; font-weight: 800; color: var(--accent); }
.stat-label { font-size: 11px; color: var(--text-sub); margin-top: 2px; }

/* ===== QUESTION SCREEN (EXAM PAPER STYLE) ===== */
.q-screen { display: none; padding: 16px 0 100px; }
.q-paper {
  background: var(--paper);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 20px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.06);
}
.q-num-label {
  font-size: 15px; font-weight: 800; color: var(--accent);
  margin-bottom: 12px;
}
.q-text {
  font-size: 16px; font-weight: 500; line-height: 1.7;
  margin-bottom: 20px;
  word-break: keep-all;
}
.q-box {
  background: var(--accent-light);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 12px 14px;
  margin: -8px 0 20px;
  font-size: 14px; line-height: 1.6;
}

/* Choices - exam paper style */
.choice-list { display: flex; flex-direction: column; gap: 0; }
.choice-row {
  display: flex; align-items: flex-start; gap: 10px;
  padding: 10px 12px;
  border-bottom: 1px dotted var(--border);
  cursor: pointer;
  transition: background 0.15s;
  border-radius: 4px;
}
.choice-row:last-child { border-bottom: none; }
.choice-row:hover { background: rgba(0,0,0,0.02); }
.choice-circle {
  font-size: 16px; font-weight: 500;
  min-width: 24px; flex-shrink: 0;
  color: var(--text-sub);
  padding-top: 1px;
}
.choice-content {
  font-size: 15px; line-height: 1.6;
  flex: 1; word-break: keep-all;
}

/* Study mode - correct answer bold */
.choice-row.correct-bold .choice-circle {
  color: var(--correct); font-weight: 800;
}
.choice-row.correct-bold .choice-content {
  font-weight: 700; color: var(--correct);
}

/* Practice mode - selected */
.choice-row.selected-correct {
  background: var(--correct-bg);
}
.choice-row.selected-correct .choice-circle {
  color: var(--correct); font-weight: 800;
}
.choice-row.selected-correct .choice-content {
  font-weight: 700; color: var(--correct);
}
.choice-row.selected-wrong {
  background: var(--wrong-bg);
}
.choice-row.selected-wrong .choice-circle {
  color: var(--wrong); font-weight: 800;
}
.choice-row.selected-wrong .choice-content {
  color: var(--wrong); text-decoration: line-through;
}
.choice-row.show-correct .choice-circle {
  color: var(--correct); font-weight: 800;
}
.choice-row.show-correct .choice-content {
  font-weight: 700; color: var(--correct);
}
.choice-row.disabled { pointer-events: none; }

/* Result badge */
.result-badge {
  display: none; text-align: center; margin-top: 16px;
  font-size: 15px; font-weight: 700; padding: 10px;
  border-radius: 6px;
}
.result-badge.correct { background: var(--correct-bg); color: var(--correct); }
.result-badge.wrong { background: var(--wrong-bg); color: var(--wrong); }

/* Explanation */
.explanation {
  margin-top: 16px; padding: 12px 14px;
  border: none;
  border-left: 3px solid var(--border);
  background: transparent;
  font-size: 13px; line-height: 1.6;
  color: var(--text-sub);
  display: none; border-radius: 0;
}
.explanation-label {
  font-weight: 600; color: var(--text-sub); margin-bottom: 4px;
  font-size: 12px;
}

/* Bottom Nav */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: var(--bg);
  border-top: 1px solid var(--border);
  padding: 8px 24px; padding-bottom: max(8px, env(safe-area-inset-bottom));
  display: none; z-index: 100;
  opacity: 0.9;
}
.bottom-nav-inner {
  max-width: 600px; margin: 0 auto;
  display: flex; justify-content: space-between; align-items: center;
}
.nav-btn {
  padding: 8px 20px; border-radius: 6px;
  border: 1px solid var(--border); font-size: 13px; font-weight: 600;
  cursor: pointer; font-family: var(--font); background: var(--paper);
  color: var(--text-sub); transition: all 0.2s;
}
.nav-btn:active { transform: scale(0.96); }
.nav-btn.next { background: var(--accent); color: #fff; border-color: var(--accent); opacity: 0.85; }
.nav-btn:disabled { opacity: 0.2; pointer-events: none; }
.nav-counter {
  font-size: 12px; font-weight: 600; color: var(--text-sub);
}

/* Exam Result */
.result-screen { display: none; padding: 40px 0; text-align: center; }
.result-score { font-size: 56px; font-weight: 800; color: var(--accent); }
.result-pass { color: var(--correct); font-size: 22px; font-weight: 700; margin: 8px 0; }
.result-fail { color: var(--wrong); font-size: 22px; font-weight: 700; margin: 8px 0; }
.result-detail { color: var(--text-sub); font-size: 14px; margin: 4px 0; }
.result-actions {
  margin-top: 24px; display: flex; gap: 12px; justify-content: center;
}
.result-btn {
  padding: 12px 24px; border-radius: 8px; font-size: 14px;
  font-weight: 600; cursor: pointer; border: 1px solid var(--border);
  font-family: var(--font); background: var(--paper); color: var(--text);
}
.result-btn.primary { background: var(--accent); color: #fff; border-color: var(--accent); }

/* Toast */
.toast {
  position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
  background: var(--text); color: var(--bg); padding: 10px 20px;
  border-radius: 20px; font-size: 13px; z-index: 200;
  opacity: 0; transition: opacity 0.3s; pointer-events: none;
}
.toast.show { opacity: 1; }

/* Loading */
.loading {
  text-align: center; padding: 60px 20px;
  color: var(--text-sub); font-size: 14px;
}
.spinner {
  width: 28px; height: 28px; border: 3px solid var(--border);
  border-top-color: var(--accent); border-radius: 50%;
  animation: spin 0.8s linear infinite; margin: 0 auto 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Study mode toggle */
.toggle-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 0; margin-bottom: 8px;
}
.toggle-label { font-size: 13px; font-weight: 600; color: var(--text-sub); }
.toggle {
  width: 44px; height: 24px; border-radius: 12px;
  background: var(--border); position: relative; cursor: pointer;
  transition: background 0.2s;
}
.toggle.on { background: var(--accent); }
.toggle-knob {
  width: 20px; height: 20px; border-radius: 50%;
  background: white; position: absolute; top: 2px; left: 2px;
  transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.toggle.on .toggle-knob { transform: translateX(20px); }

/* Completed exam items */
.mock-item.completed {
  background: var(--bg); opacity: 0.55;
}
.mock-item.completed .mock-item-title {
  text-decoration: line-through; color: var(--text-sub);
}
.complete-btn-active {
  background: var(--correct) !important; color: #fff !important;
  border-color: var(--correct) !important;
}

/* Ad Interstitial */
.ad-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.85);
  z-index: 400; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 20px;
}
.ad-container {
  background: #fff; border-radius: 12px;
  width: 100%; max-width: 400px; min-height: 300px;
  display: flex; align-items: center; justify-content: center;
  flex-direction: column; overflow: hidden;
}
.ad-placeholder {
  color: #999; font-size: 14px; padding: 20px; text-align: center;
}
.ad-skip {
  margin-top: 16px; padding: 10px 32px; border-radius: 8px;
  border: none; background: rgba(255,255,255,0.2); color: #fff;
  font-size: 14px; font-weight: 600; cursor: pointer;
  font-family: var(--font); transition: all 0.2s;
}
.ad-skip:disabled { opacity: 0.4; cursor: default; }
.ad-skip:not(:disabled):hover { background: rgba(255,255,255,0.3); }

/* Resume popup */
.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.4);
  z-index: 300; display: flex; align-items: center; justify-content: center;
  padding: 20px;
}
.popup {
  background: var(--paper); border-radius: 12px; padding: 24px;
  max-width: 320px; width: 100%; text-align: center;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
}
.popup-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
.popup-desc { font-size: 14px; color: var(--text-sub); margin-bottom: 20px; line-height: 1.5; }
.popup-btns { display: flex; gap: 10px; }
.popup-btn {
  flex: 1; padding: 12px; border-radius: 8px; font-size: 14px;
  font-weight: 600; cursor: pointer; border: 1px solid var(--border);
  font-family: var(--font); background: var(--paper); color: var(--text);
}
.popup-btn.primary { background: var(--accent); color: #fff; border-color: var(--accent); }

/* Section stats */
.section-stats {
  display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;
}
.section-stat-row {
  display: flex; align-items: center; gap: 10px;
  background: var(--paper); border: 1px solid var(--border);
  border-radius: 8px; padding: 10px 14px;
}
.section-stat-name { font-size: 13px; font-weight: 600; min-width: 110px; }
.section-stat-bar {
  flex: 1; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;
}
.section-stat-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
.section-stat-pct { font-size: 13px; font-weight: 700; min-width: 36px; text-align: right; }

.credit {
  text-align: center; font-size: 11px; color: var(--text-sub);
  padding: 20px 0;
}
/* Type Tab Bar */
.type-bar {
  display: flex; gap: 0; margin-bottom: 20px;
  background: var(--paper);
  border: 2px solid var(--border);
  border-radius: 8px; overflow: hidden;
}
.type-item {
  flex: 1; padding: 10px; border: none; background: var(--paper);
  font-size: 14px; font-weight: 600; cursor: pointer;
  font-family: var(--font); color: var(--text-sub);
  border-right: 2px solid var(--border);
  transition: all 0.2s;
}
.type-item:last-child { border-right: none; }
#typeLife { color: #1a3a6e; }
#typeDamage { color: #2e6b4f; }
#typeLife.active {
  background: #1a3a6e; color: #fff; border-color: #1a3a6e;
}
#typeDamage.active {
  background: #2e6b4f; color: #fff; border-color: #2e6b4f;
}
.dark #typeLife { color: #6b9eff; }
.dark #typeDamage { color: #5ec4a0; }
.dark #typeLife.active {
  background: #2a4a7e; color: #fff; border-color: #2a4a7e;
}
.dark #typeDamage.active {
  background: #2a5e4a; color: #fff; border-color: #2a5e4a;
}
/* Global Nav */
.global-nav { display: flex; flex-wrap: wrap; gap: 4px 14px; padding: 8px 24px; background: var(--bg); border-bottom: 1px solid var(--border); }
.global-nav a { color: var(--accent); text-decoration: none; font-size: 13px; font-weight: 600; }
.global-nav a:hover { text-decoration: underline; }
/* Guide Cards on Home */
.guide-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
.guide-card { background: var(--paper); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-decoration: none; color: inherit; transition: all 0.15s; display: block; }
.guide-card:active { transform: scale(0.97); }
.guide-card-tag { font-size: 10px; font-weight: 600; color: var(--accent); background: var(--accent-light); padding: 2px 6px; border-radius: 8px; display: inline-block; margin-bottom: 4px; }
.guide-card-title { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
.guide-card-desc { font-size: 11px; color: var(--text-sub); }
.global-footer { text-align: center; padding: 8px 0 16px; font-size: 12px; }
.global-footer a { color: var(--text-sub); text-decoration: none; margin: 0 4px; }
</style>
</head>
<body>

<!-- Global Navigation -->
<div class="global-nav" id="globalNav">
  <a href="index.html">홈</a>
  <a href="guide.html">학습 가이드</a>
  <a href="exam-guide.html">시험 정보</a>
  <a href="about.html">소개</a>
  <a href="contact.html">연락처</a>
</div>

<!-- Header -->
<div class="exam-header">
  <div class="exam-header-top">
    <div style="display:flex;align-items:center">
      <button class="back-arrow" id="backBtn" onclick="goBack()">&#8592;</button>
      <span class="exam-title" id="headerTitle">생명·손해·제3보험 모의고사</span>
    </div>
    <div class="exam-controls">
      <button class="ctrl-btn" id="completeBtn" style="display:none" onclick="markComplete()">&#10003; 완료</button>
      <button class="ctrl-btn" id="bookmarkBtn" style="display:none" onclick="toggleBookmark()">&#9734;</button>
      <button class="ctrl-btn" onclick="toggleDark()">&#9790;</button>
    </div>
  </div>
  <div class="exam-section-bar" id="sectionBar" style="display:none">
    <span class="section-label" id="sectionLabel"></span>
    <span id="progressLabel"></span>
  </div>
  <div class="progress-mini" id="progressBar" style="display:none">
    <div class="progress-mini-fill" id="progressFill"></div>
  </div>
</div>

<!-- Home -->
<div id="homeScreen">
  <div class="container home">
    <!-- Insurance Type Tab -->
    <div class="type-bar">
      <button class="type-item active" id="typeLife" onclick="setInsType('life')">생명·제3보험</button>
      <button class="type-item" id="typeDamage" onclick="setInsType('damage')">손해·제3보험</button>
    </div>

    <!-- Mode -->
    <div class="mode-bar">
      <button class="mode-item active" id="modeStudy" onclick="setMode('study')">학습모드</button>
      <button class="mode-item" id="modePractice" onclick="setMode('practice')">시험모드</button>
    </div>

    <!-- Study mode panel -->
    <div id="studyPanel">
      <div class="toggle-row">
        <span class="toggle-label">정답 표시하기</span>
        <div class="toggle on" id="highlightToggle" onclick="toggleHighlight()">
          <div class="toggle-knob"></div>
        </div>
      </div>
      <div class="special-row" style="grid-template-columns:1fr 1fr">
        <div class="special-btn" onclick="startQuiz('all_mock')">
          <div class="special-btn-icon">&#128221;</div>
          <div class="special-btn-label">전체 학습</div>
          <div class="special-btn-count" id="allCount">0</div>
        </div>
        <div class="special-btn" onclick="startQuiz('bookmarks')">
          <div class="special-btn-icon">&#9733;</div>
          <div class="special-btn-label">북마크</div>
          <div class="special-btn-count" id="bmCount">0</div>
        </div>
      </div>
    </div>

    <!-- Practice mode panel -->
    <div id="practicePanel" style="display:none">
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-num" id="statPTotal">0</div>
          <div class="stat-label">전체</div>
        </div>
        <div class="stat-box">
          <div class="stat-num" id="statDone">0</div>
          <div class="stat-label">완료</div>
        </div>
        <div class="stat-box">
          <div class="stat-num" id="statRate">-</div>
          <div class="stat-label">정답률</div>
        </div>
      </div>
      <div class="special-row">
        <div class="special-btn" onclick="startQuiz('all_mock')">
          <div class="special-btn-icon">&#128221;</div>
          <div class="special-btn-label">전체</div>
          <div class="special-btn-count" id="allCountP">0</div>
        </div>
        <div class="special-btn" onclick="startQuiz('bookmarks')">
          <div class="special-btn-icon">&#9733;</div>
          <div class="special-btn-label">북마크</div>
          <div class="special-btn-count" id="bmCountP">0</div>
        </div>
        <div class="special-btn" onclick="startQuiz('wrong')">
          <div class="special-btn-icon">&#10060;</div>
          <div class="special-btn-label">오답</div>
          <div class="special-btn-count" id="wrongCount">0</div>
        </div>
      </div>
      <div class="options-row">
        <button class="opt-btn" onclick="startRandomQuiz(20)">&#127922; 랜덤 20문제</button>
        <button class="opt-btn" id="randomMaxBtn" onclick="startRandomQuiz(40)">&#127922; 랜덤 40문제</button>
        <button class="opt-btn" id="shuffleBtn" onclick="toggleShuffle()">&#128256; 셔플</button>
      </div>
      <!-- Section accuracy -->
      <div id="sectionStats"></div>
      <div class="options-row">
        <button class="opt-btn" onclick="resetProgress()">&#128260; 초기화</button>
      </div>
    </div>

    <!-- Section-based study -->
    <div class="cat-section" id="sectionStudy"></div>

    <!-- 2025 Mock Exams (Primary) -->
    <div class="cat-section" id="mockSection"></div>

    <!-- 학습 가이드 섹션 -->
    <div class="cat-section">
      <div class="cat-section-title">학습 가이드</div>
      <div class="guide-cards">
        <a href="exam-guide.html" class="guide-card">
          <span class="guide-card-tag">시험안내</span>
          <div class="guide-card-title">보험 자격시험 안내</div>
          <div class="guide-card-desc">시험과목, 합격 기준, 일정</div>
        </a>
        <a href="study-guide.html" class="guide-card">
          <span class="guide-card-tag">학습전략</span>
          <div class="guide-card-title">학습 방법 가이드</div>
          <div class="guide-card-desc">4단계 학습법</div>
        </a>
        <a href="guide-life-insurance.html" class="guide-card">
          <span class="guide-card-tag">생명보험</span>
          <div class="guide-card-title">생명보험 시험 가이드</div>
          <div class="guide-card-desc">접수부터 합격까지</div>
        </a>
        <a href="guide-damage-insurance.html" class="guide-card">
          <span class="guide-card-tag">손해보험</span>
          <div class="guide-card-title">손해보험 합격 전략</div>
          <div class="guide-card-desc">과목별 대비 전략</div>
        </a>
      </div>
      <div style="text-align:center;margin-bottom:16px">
        <a href="guide.html" style="color:var(--accent);font-size:13px;font-weight:600;text-decoration:none">전체 가이드 보기 &rarr;</a>
      </div>
    </div>

    <div class="credit" id="creditText">2025 생명보험 모의고사 기출문제 기반</div>
    <div class="global-footer">
      <a href="guide.html">학습 가이드</a> &middot;
      <a href="exam-guide.html">시험 정보</a> &middot;
      <a href="about.html">소개</a> &middot;
      <a href="contact.html">연락처</a><br>
      <a href="privacy.html">개인정보처리방침</a> &middot;
      <a href="terms.html">이용약관</a>
      <p style="margin-top:4px;color:var(--text-sub)">&copy; 2025 보험 모의고사</p>
    </div>
  </div>
</div>

<!-- Question Screen -->
<div class="q-screen" id="qScreen">
  <div class="container">
    <div class="q-paper">
      <div class="q-num-label" id="qNum"></div>
      <div class="q-text" id="qText"></div>
      <div class="q-box" id="qBox" style="display:none"></div>
      <div class="choice-list" id="choiceList"></div>
    </div>
    <div class="result-badge" id="resultBadge"></div>
    <div class="explanation" id="explanation">
      <div class="explanation-label">해설</div>
      <div id="explText"></div>
    </div>
  </div>
</div>

<!-- Result Screen -->
<div class="result-screen" id="resultScreen">
  <div class="container" id="resultContent"></div>
</div>

<!-- Bottom Nav -->
<div class="bottom-nav" id="bottomNav">
  <div class="bottom-nav-inner">
    <button class="nav-btn" id="prevBtn" onclick="prevQ()">&#9664; 이전</button>
    <span class="nav-counter" id="navCounter"></span>
    <button class="nav-btn next" id="nextBtn" onclick="nextQ()">다음 &#9654;</button>
  </div>
</div>

<!-- Resume Popup -->
<div class="popup-overlay" id="resumePopup" style="display:none">
  <div class="popup">
    <div class="popup-title" id="resumeTitle">이어서 학습</div>
    <div class="popup-desc" id="resumeDesc"></div>
    <div class="popup-btns">
      <button class="popup-btn" onclick="resumeFrom(0)">처음부터</button>
      <button class="popup-btn primary" id="resumeBtn" onclick="resumeFrom(-1)">이어서</button>
    </div>
  </div>
</div>

<!-- Ad Interstitial -->
<div class="ad-overlay" id="adOverlay" style="display:none">
  <div class="ad-container" id="adContainer">
    <!-- AdSense 광고 단위: 슬롯 ID를 발급받은 후 data-ad-slot 값을 교체하세요 -->
    <ins class="adsbygoogle"
      style="display:block; width:100%; min-height:250px;"
      data-ad-client="ca-pub-6687538764913740"
      data-ad-slot="1190202125"
      data-ad-format="auto"
      data-full-width-responsive="true"></ins>
  </div>
  <button class="ad-skip" id="adSkipBtn" disabled onclick="closeAd()">3초 후 시작</button>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Loading -->
<div class="loading" id="loading">
  <div class="spinner"></div>
  <div>문제 불러오는 중...</div>
</div>

<!-- SEO: 크롤러용 정적 콘텐츠 -->
<noscript>
<div style="max-width:560px;margin:0 auto;padding:24px;font-family:-apple-system,'Malgun Gothic',sans-serif;color:#1a1a1a;line-height:1.8">
  <h1 style="font-size:22px;color:#1a3a6e;border-bottom:2px solid #1a3a6e;padding-bottom:8px">보험 모의고사 - 생명·손해·제3보험 기출문제 학습</h1>
  <p>2025년 생명보험, 손해보험, 제3보험 자격시험을 준비하는 수험생을 위한 무료 온라인 모의고사 서비스입니다. 2000개 이상의 실제 기출문제와 상세 해설을 제공합니다.</p>

  <h2 style="font-size:18px;color:#1a3a6e;margin-top:24px">학습 과목</h2>
  <ul>
    <li><strong>생명보험</strong> - 보험이론 및 윤리, 보험법규, 생명보험, 제3보험</li>
    <li><strong>손해보험</strong> - 보험이론 및 윤리, 보험법규, 손해보험, 제3보험</li>
  </ul>

  <h2 style="font-size:18px;color:#1a3a6e;margin-top:24px">주요 기능</h2>
  <ul>
    <li><strong>학습모드</strong> - 정답과 해설을 보며 학습. 정답 표시 on/off 선택 가능</li>
    <li><strong>시험모드</strong> - 실전처럼 문제 풀고 점수 확인 (합격 기준 60점)</li>
    <li><strong>영역별 학습</strong> - 보험이론, 보험법규, 생명/손해보험, 제3보험 영역별 집중 학습</li>
    <li><strong>연도별 모의고사</strong> - 2024~2025년 실제 기출문제를 회차별로 풀기</li>
    <li><strong>오답노트</strong> - 틀린 문제만 모아서 반복 학습</li>
    <li><strong>북마크</strong> - 중요한 문제 저장 후 나중에 복습</li>
    <li><strong>랜덤 퀴즈</strong> - 무작위 20문제 또는 40~50문제 연습</li>
    <li><strong>진행률 추적</strong> - 영역별 정답률과 학습 완료 현황 확인</li>
  </ul>

  <h2 style="font-size:18px;color:#1a3a6e;margin-top:24px">보험 자격시험 안내</h2>
  <p>보험설계사 자격시험은 생명보험협회와 손해보험협회에서 주관하며, 매월 시행됩니다. 시험은 객관식 5지선다 형식으로 출제되며, 합격 기준은 전 과목 평균 60점 이상입니다.</p>
  <ul>
    <li>생명보험: 보험이론 및 윤리 + 보험법규 + 생명보험 + 제3보험 (40문제)</li>
    <li>손해보험: 보험이론 및 윤리 + 보험법규 + 손해보험 + 제3보험 (50문제)</li>
  </ul>

  <h2 style="font-size:18px;color:#1a3a6e;margin-top:24px">효과적인 학습 방법</h2>
  <ol>
    <li>먼저 학습모드에서 영역별로 전체 문제를 한 번 훑어보세요.</li>
    <li>시험모드로 전환하여 회차별 모의고사를 실전처럼 풀어보세요.</li>
    <li>오답노트에서 틀린 문제를 반복 학습하세요.</li>
    <li>랜덤 퀴즈로 실전 감각을 유지하세요.</li>
  </ol>

  <p style="margin-top:24px"><a href="exam-guide.html">보험 자격시험 상세 안내</a> | <a href="study-guide.html">학습 방법 가이드</a> | <a href="privacy.html">개인정보 처리방침</a></p>
  <p style="color:#888;font-size:12px;margin-top:16px">이 서비스를 이용하려면 JavaScript를 활성화해 주세요.</p>
</div>
</noscript>

<script src="data.js"></script>
<script src="data_sonbo.js"></script>
<script>
// ===== STATE =====
let allQuestions = [];
let lifeQuestions = [];
let damageQuestions = [];
let currentQuiz = [];
let currentIdx = 0;
let mode = 'study';
let showHighlight = true;
let shuffleEnabled = false;
let darkMode = false;
let answered = {};
let insType = 'life';

function getLS() {
  const prefix = insType === 'damage' ? 'sonbo_' : 'insu_';
  return {
    bookmarks: prefix + 'bm2',
    wrong: prefix + 'wr2',
    answered: prefix + 'ans2',
    correct: prefix + 'cor2',
    completed: prefix + 'comp',
    lastPos: prefix + 'pos',
    mode: 'insu_mode',
    highlight: 'insu_hl',
    shuffle: 'insu_shf',
    dark: 'insu_dk',
  };
}
let LS = getLS();

const CIRCLES = ['\u2460','\u2461','\u2462','\u2463','\u2464'];

// ===== INIT =====
function init() {
  mode = localStorage.getItem(LS.mode) || 'study';
  showHighlight = localStorage.getItem(LS.highlight) !== 'false';
  shuffleEnabled = localStorage.getItem(LS.shuffle) === 'true';
  darkMode = localStorage.getItem(LS.dark) === 'true';

  if (darkMode) document.body.classList.add('dark');

  // Generate PNG icon for iOS
  try {
    const c = document.createElement('canvas');
    c.width = 180; c.height = 180;
    const ctx = c.getContext('2d');
    ctx.fillStyle = '#1a3a6e';
    ctx.beginPath(); ctx.roundRect(0, 0, 180, 180, 36); ctx.fill();
    ctx.font = '90px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('\u{1F4DD}', 90, 96);
    document.getElementById('touchIcon').href = c.toDataURL('image/png');
  } catch {}

  // Init both datasets
  if (typeof EMBEDDED_DATA !== 'undefined') {
    lifeQuestions = EMBEDDED_DATA;
    lifeQuestions.forEach((q, i) => q.id = i + 1);
  }
  if (typeof EMBEDDED_DATA_SONBO !== 'undefined') {
    damageQuestions = EMBEDDED_DATA_SONBO;
    damageQuestions.forEach((q, i) => q.id = i + 1);
  }

  // Restore insurance type
  insType = localStorage.getItem('insu_type') || 'life';
  LS = getLS();
  allQuestions = insType === 'damage' ? damageQuestions : lifeQuestions;

  updateInsTypeUI();
  updateModeUI();
  updateHighlightUI();
  updateShuffleUI();

  document.getElementById('loading').style.display = 'none';
  renderHome();
}

// ===== HOME =====
function getMockQs() {
  return allQuestions.filter(q => !q.archive);
}

function renderHome() {
  const saved = getSet(LS.answered);
  const correct = getSet(LS.correct);
  const bm = getSet(LS.bookmarks);
  const wrong = getSet(LS.wrong);
  const comp = getSet(LS.completed);

  const mockQs = getMockQs();

  const mockSaved = mockQs.filter(q => saved.has(String(q.id)));
  const mockCorrect = mockQs.filter(q => correct.has(String(q.id)));


  // Study panel
  document.getElementById('allCount').textContent = mockQs.length + '문제';
  document.getElementById('bmCount').textContent = bm.size + '문제';

  // Practice panel
  document.getElementById('statPTotal').textContent = mockQs.length;
  document.getElementById('statDone').textContent = mockSaved.length;
  document.getElementById('statRate').textContent =
    mockSaved.length > 0 ? Math.round(mockCorrect.length / mockSaved.length * 100) + '%' : '-';
  document.getElementById('allCountP').textContent = mockQs.length + '문제';
  document.getElementById('bmCountP').textContent = bm.size + '문제';
  document.getElementById('wrongCount').textContent = wrong.size + '문제';

  const sectionOrder = insType === 'damage'
    ? ['보험이론 및 윤리', '보험법규', '손해보험', '제3보험']
    : ['보험이론 및 윤리', '보험법규', '생명보험', '제3보험'];

  // Update random button for damage insurance (50 questions)
  const maxRandom = insType === 'damage' ? 50 : 40;
  const rmb = document.getElementById('randomMaxBtn');
  rmb.innerHTML = '&#127922; 랜덤 ' + maxRandom + '문제';
  rmb.setAttribute('onclick', 'startRandomQuiz(' + maxRandom + ')');

  // Update credit text
  document.getElementById('creditText').textContent =
    insType === 'damage' ? '2025 손해보험 모의고사 기출문제 기반' : '2025 생명보험 모의고사 기출문제 기반';

  // Section accuracy stats (practice mode)
  let statsHtml = '<div class="cat-section-title">영역별 정답률</div><div class="section-stats">';
  sectionOrder.forEach(s => {
    const secQs = mockQs.filter(q => q.section === s);
    const secAnswered = secQs.filter(q => saved.has(String(q.id)));
    const secCorrect = secQs.filter(q => correct.has(String(q.id)));
    const pct = secAnswered.length > 0 ? Math.round(secCorrect.length / secAnswered.length * 100) : -1;
    const barColor = pct >= 60 ? 'var(--correct)' : pct >= 0 ? 'var(--wrong)' : 'var(--border)';
    statsHtml += `<div class="section-stat-row">
      <span class="section-stat-name">${s}</span>
      <div class="section-stat-bar"><div class="section-stat-fill" style="width:${pct >= 0 ? pct : 0}%;background:${barColor}"></div></div>
      <span class="section-stat-pct" style="color:${barColor}">${pct >= 0 ? pct + '%' : '-'}</span>
    </div>`;
  });
  statsHtml += '</div>';
  document.getElementById('sectionStats').innerHTML = statsHtml;

  // Group mock categories by year
  const cats = {};
  mockQs.forEach(q => {
    const c = q.category;
    if (!cats[c]) cats[c] = [];
    cats[c].push(q);
  });

  // Section-based study (보험이론, 보험법규, 생명보험, 제3보험)
  const sections = {};
  mockQs.forEach(q => {
    const s = q.section || '기타';
    if (!sections[s]) sections[s] = [];
    sections[s].push(q);
  });
  let secHtml = '<div class="cat-section-title">영역별 학습</div>';
  secHtml += '<div class="cat-grid">';
  sectionOrder.forEach(s => {
    const qs = sections[s] || [];
    if (qs.length === 0) return;
    const done = qs.filter(q => saved.has(String(q.id))).length;
    const pct = qs.length > 0 ? Math.round(done / qs.length * 100) : 0;
    secHtml += `<div class="cat-item" onclick="startQuiz('section:${s}')">
      <div class="cat-item-title">${s}</div>
      <div class="cat-item-sub">${qs.length}문제${done > 0 ? ' · ' + pct + '%' : ''}</div>
      <div class="cat-item-bar"><div class="cat-item-bar-fill" style="width:${pct}%"></div></div>
    </div>`;
  });
  secHtml += '</div>';
  document.getElementById('sectionStudy').innerHTML = secHtml;

  // Separate by year
  const years = {};
  Object.keys(cats).sort((a, b) => {
    const am = a.match(/(\d+)월\s*(\d+)회/);
    const bm = b.match(/(\d+)월\s*(\d+)회/);
    if (am && bm) return (parseInt(am[1]) * 10 + parseInt(am[2])) - (parseInt(bm[1]) * 10 + parseInt(bm[2]));
    return a.localeCompare(b);
  }).forEach(c => {
    const ym = c.match(/^(\d{4})년/);
    const year = ym ? ym[1] : '기타';
    if (!years[year]) years[year] = [];
    years[year].push(c);
  });

  // Render mock exams by year (newest first)
  let mockHtml = '';
  Object.keys(years).sort().reverse().forEach(year => {
    const yearCats = years[year];
    const yearQs = yearCats.flatMap(c => cats[c]);
    const yearDone = yearQs.filter(q => saved.has(String(q.id))).length;
    const yearPct = yearQs.length > 0 ? Math.round(yearDone / yearQs.length * 100) : 0;

    mockHtml += `<div class="cat-section-title">${year}년 모의고사 (${yearCats.length}회 · ${yearQs.length}문제${yearDone > 0 ? ' · ' + yearPct + '%' : ''})</div>`;
    mockHtml += '<div class="mock-list">';

    // Sort: incomplete first, completed last
    const sortedCats = [...yearCats].sort((a, b) => {
      const ac = comp.has(a) ? 1 : 0;
      const bc = comp.has(b) ? 1 : 0;
      return ac - bc;
    });

    sortedCats.forEach(c => {
      const qs = cats[c];
      const isComp = comp.has(c);
      const done = qs.filter(q => saved.has(String(q.id))).length;
      const pct = qs.length > 0 ? Math.round(done / qs.length * 100) : 0;
      let badge = '';
      if (isComp) badge = '<span class="mock-badge done">&#10003; 완료</span>';
      else if (pct === 100) badge = '<span class="mock-badge done">완료</span>';
      else if (done > 0) badge = `<span class="mock-badge partial">${pct}%</span>`;

      mockHtml += `<div class="mock-item${isComp ? ' completed' : ''}" onclick="startQuiz('cat:${c}')">
        <div class="mock-item-title">${c.replace(year + '년 ', '')}</div>
        <div class="mock-item-info">
          <span>${qs.length}문제</span>
          ${badge}
        </div>
      </div>`;
    });
    mockHtml += '</div>';
  });
  document.getElementById('mockSection').innerHTML = mockHtml;

}


// ===== QUIZ =====
let currentFilter = '';
let pendingResumeIdx = 0;

function startQuiz(filter) {
  let qs = [];
  if (filter === 'all_mock') qs = getMockQs();
  else if (filter === 'all') qs = [...allQuestions];
  else if (filter === 'bookmarks') {
    const bm = getSet(LS.bookmarks);
    qs = allQuestions.filter(q => bm.has(String(q.id)));
  } else if (filter === 'wrong') {
    const wr = getSet(LS.wrong);
    qs = allQuestions.filter(q => wr.has(String(q.id)));
  } else if (filter.startsWith('section:')) {
    const sec = filter.substring(8);
    qs = getMockQs().filter(q => q.section === sec);
  } else if (filter.startsWith('cat:')) {
    qs = allQuestions.filter(q => q.category === filter.substring(4));
  } else if (filter.startsWith('cat_prefix:')) {
    const pfx = filter.substring(11);
    qs = allQuestions.filter(q => q.category.startsWith(pfx));
  }

  if (qs.length === 0) { showToast('문제가 없습니다'); return; }
  if (shuffleEnabled) qs = shuffle(qs);

  currentQuiz = qs;
  currentIdx = 0;
  currentFilter = filter;
  answered = {};

  // Check for resume position
  const lastPos = getLastPos(filter);
  if (lastPos > 0 && lastPos < qs.length) {
    pendingResumeIdx = lastPos;
    document.getElementById('resumeDesc').textContent =
      `이전에 ${lastPos + 1}번째 문제까지 봤습니다.\n이어서 보시겠습니까?`;
    document.getElementById('resumePopup').style.display = 'flex';
    return;
  }

  enterQuiz();
}

function startRandomQuiz(n) {
  let qs = shuffle(getMockQs()).slice(0, n);
  if (qs.length === 0) { showToast('문제가 없습니다'); return; }
  currentQuiz = qs;
  currentIdx = 0;
  currentFilter = 'random_' + n;
  answered = {};
  enterQuiz();
}

function resumeFrom(idx) {
  document.getElementById('resumePopup').style.display = 'none';
  if (idx === -1) currentIdx = pendingResumeIdx;
  else currentIdx = 0;
  enterQuiz();
}

let adTimer = null;
const isNative = window.Capacitor && window.Capacitor.isNativePlatform();
let admobReady = false;

// AdMob 초기화 (네이티브 앱 전용)
if (isNative) {
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const AdMob = Capacitor.Plugins.AdMob;
      await AdMob.initialize({ initializeForTesting: false });
      admobReady = true;
    } catch(e) { console.warn('AdMob init failed:', e); }
  });
}

function enterQuiz() {
  showAd(() => {
    document.getElementById('homeScreen').style.display = 'none';
    document.getElementById('qScreen').style.display = 'block';
    document.getElementById('resultScreen').style.display = 'none';
    document.getElementById('bottomNav').style.display = 'block';
    document.getElementById('backBtn').style.display = 'inline';
    document.getElementById('bookmarkBtn').style.display = 'inline';
    document.getElementById('sectionBar').style.display = 'flex';
    document.getElementById('progressBar').style.display = 'block';
    updateCompleteBtn();
    renderQ();
  });
}

function showAd(callback) {
  if (isNative && admobReady) {
    showAdMobInterstitial(callback);
  } else if (isNative) {
    callback();
  } else {
    showAdSense(callback);
  }
}

// 네이티브: AdMob 전면 광고
async function showAdMobInterstitial(callback) {
  try {
    const AdMob = Capacitor.Plugins.AdMob;
    await AdMob.prepareInterstitial({ adId: 'ca-app-pub-6687538764913740/1876597835' });
    await AdMob.showInterstitial();
    callback();
  } catch(e) {
    console.warn('AdMob interstitial failed:', e);
    callback();
  }
}

// 웹: AdSense 전면 광고
function showAdSense(callback) {
  window._adCallback = callback;
  const btn = document.getElementById('adSkipBtn');
  btn.disabled = true;
  let sec = 3;
  btn.textContent = sec + '초 후 시작';
  document.getElementById('adOverlay').style.display = 'flex';
  try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e) {}
  adTimer = setInterval(() => {
    sec--;
    if (sec > 0) {
      btn.textContent = sec + '초 후 시작';
    } else {
      clearInterval(adTimer);
      btn.textContent = '시작하기';
      btn.disabled = false;
    }
  }, 1000);
}
function closeAd() {
  clearInterval(adTimer);
  document.getElementById('adOverlay').style.display = 'none';
  if (window._adCallback) { window._adCallback(); window._adCallback = null; }
}

function getLastPos(filter) {
  try {
    const data = JSON.parse(localStorage.getItem(LS.lastPos) || '{}');
    return data[filter] || 0;
  } catch { return 0; }
}
function saveLastPos() {
  try {
    const data = JSON.parse(localStorage.getItem(LS.lastPos) || '{}');
    data[currentFilter] = currentIdx;
    localStorage.setItem(LS.lastPos, JSON.stringify(data));
  } catch {}
}

function renderQ() {
  if (currentIdx >= currentQuiz.length) { showResult(); return; }

  const q = currentQuiz[currentIdx];
  const section = q.section || q.category;

  // Header
  document.getElementById('headerTitle').textContent = q.category;
  document.getElementById('sectionLabel').textContent = section;
  const pct = ((currentIdx + 1) / currentQuiz.length * 100).toFixed(0);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = `${currentIdx + 1} / ${currentQuiz.length}`;

  // Question number
  const srcNum = q.source_q_num || (currentIdx + 1);
  document.getElementById('qNum').textContent = `${srcNum}.`;

  // Question text - check if there's a box/table content
  const qText = q.question;
  document.getElementById('qText').textContent = qText;
  document.getElementById('qBox').style.display = 'none';

  // Bookmark
  const bm = getSet(LS.bookmarks);
  document.getElementById('bookmarkBtn').innerHTML = bm.has(String(q.id)) ? '&#9733;' : '&#9734;';

  // Choices
  const list = document.getElementById('choiceList');
  let html = '';
  q.choices.forEach((c, i) => {
    const num = i + 1;
    let cls = '';

    if (mode === 'study' && showHighlight && num === q.answer) {
      cls = 'correct-bold';
    }

    // Study mode: highlight off, user tapped a choice
    if (mode === 'study' && !showHighlight && answered[q.id] !== undefined) {
      const sel = answered[q.id];
      if (num === q.answer) {
        cls = sel === num ? 'selected-correct' : 'show-correct';
      } else if (num === sel) {
        cls = 'selected-wrong';
      }
      cls += ' disabled';
    }

    if (mode === 'practice' && answered[q.id] !== undefined) {
      const sel = answered[q.id];
      if (num === q.answer) {
        cls = sel === num ? 'selected-correct' : 'show-correct';
      } else if (num === sel) {
        cls = 'selected-wrong';
      }
      cls += ' disabled';
    }

    html += `<div class="choice-row ${cls}" onclick="selectChoice(${q.id},${num})">
      <span class="choice-circle">${CIRCLES[i]}</span>
      <span class="choice-content">${esc(c)}</span>
    </div>`;
  });
  list.innerHTML = html;

  // Result badge
  const badge = document.getElementById('resultBadge');
  badge.style.display = 'none';
  const showBadge = (mode === 'practice' || (mode === 'study' && !showHighlight)) && answered[q.id] !== undefined;
  if (showBadge) {
    badge.style.display = 'block';
    if (answered[q.id] === q.answer) {
      badge.className = 'result-badge correct';
      badge.textContent = '정답!';
    } else {
      badge.className = 'result-badge wrong';
      badge.textContent = '오답 (정답: ' + CIRCLES[q.answer - 1] + ')';
    }
  }

  // Explanation
  const explEl = document.getElementById('explanation');
  const explText = document.getElementById('explText');
  const showExpl = (mode === 'study' && showHighlight) ||
    (mode === 'study' && !showHighlight && answered[q.id] !== undefined) ||
    (mode === 'practice' && answered[q.id] !== undefined);
  if (showExpl) {
    if (q.explanation && q.explanation.trim()) {
      explEl.style.display = 'block';
      explText.textContent = q.explanation;
    } else {
      explEl.style.display = 'none';
    }
  } else {
    explEl.style.display = 'none';
  }

  // Nav
  document.getElementById('prevBtn').disabled = currentIdx === 0;
  document.getElementById('navCounter').textContent =
    mode === 'practice' ? `${Object.keys(answered).length}/${currentQuiz.length}` : '';

  // Save last position
  saveLastPos();

  window.scrollTo(0, 0);
}

function selectChoice(qid, choice) {
  // Study mode: if highlight is off, allow tapping to reveal answer
  if (mode === 'study') {
    if (showHighlight) return; // already showing answers
    if (answered[qid] !== undefined) return;
    answered[qid] = choice;
    renderQ();
    return;
  }
  if (answered[qid] !== undefined) return;

  const q = currentQuiz[currentIdx];
  answered[qid] = choice;

  addToSet(LS.answered, String(qid));
  if (choice === q.answer) {
    addToSet(LS.correct, String(qid));
    removeFromSet(LS.wrong, String(qid));
  } else {
    addToSet(LS.wrong, String(qid));
    addToSet(LS.bookmarks, String(qid));
    removeFromSet(LS.correct, String(qid));
  }
  renderQ();
}

function nextQ() {
  if (currentIdx < currentQuiz.length - 1) { currentIdx++; renderQ(); }
  else if (mode === 'practice') showResult();
}
function prevQ() {
  if (currentIdx > 0) { currentIdx--; renderQ(); }
}

// ===== RESULT =====
function showResult() {
  if (mode !== 'practice') { goHome(); return; }

  const total = currentQuiz.length;
  let correct = 0;
  currentQuiz.forEach(q => { if (answered[q.id] === q.answer) correct++; });
  const score = total > 0 ? Math.round(correct / total * 100) : 0;
  const pass = score >= 60;

  document.getElementById('qScreen').style.display = 'none';
  document.getElementById('resultScreen').style.display = 'block';
  document.getElementById('bottomNav').style.display = 'none';
  document.getElementById('sectionBar').style.display = 'none';
  document.getElementById('progressBar').style.display = 'none';

  document.getElementById('resultContent').innerHTML = `
    <div style="margin-top:20px">
      <div class="result-score">${score}점</div>
      <div class="${pass ? 'result-pass' : 'result-fail'}">
        ${pass ? '합격' : '불합격'}
      </div>
      <div class="result-detail">${correct}/${total} 정답 (합격 기준: 60점)</div>
      <div class="result-detail">오답: ${total - correct}문제</div>
      <div class="result-actions">
        <button class="result-btn" onclick="startQuiz('wrong')">오답 다시 풀기</button>
        <button class="result-btn primary" onclick="goHome()">홈으로</button>
      </div>
    </div>`;
}

// ===== NAV =====
function goBack() { goHome(); }
function goHome() {
  document.getElementById('homeScreen').style.display = 'block';
  document.getElementById('qScreen').style.display = 'none';
  document.getElementById('resultScreen').style.display = 'none';
  document.getElementById('bottomNav').style.display = 'none';
  document.getElementById('backBtn').style.display = 'none';
  document.getElementById('bookmarkBtn').style.display = 'none';
  document.getElementById('completeBtn').style.display = 'none';
  document.getElementById('sectionBar').style.display = 'none';
  document.getElementById('progressBar').style.display = 'none';
  document.getElementById('headerTitle').textContent = '생명·손해·제3보험 모의고사';
  renderHome();
}

// ===== SETTINGS =====
function setMode(m) {
  mode = m; localStorage.setItem(LS.mode, m);
  updateModeUI();
  renderHome();
}
function updateModeUI() {
  document.getElementById('modeStudy').className = 'mode-item' + (mode === 'study' ? ' active' : '');
  document.getElementById('modePractice').className = 'mode-item' + (mode === 'practice' ? ' active' : '');
  document.getElementById('studyPanel').style.display = mode === 'study' ? 'block' : 'none';
  document.getElementById('practicePanel').style.display = mode === 'practice' ? 'block' : 'none';
}
function toggleHighlight() {
  showHighlight = !showHighlight;
  localStorage.setItem(LS.highlight, showHighlight);
  updateHighlightUI();
}
function updateHighlightUI() {
  document.getElementById('highlightToggle').className = 'toggle' + (showHighlight ? ' on' : '');
}
function toggleShuffle() {
  shuffleEnabled = !shuffleEnabled;
  localStorage.setItem(LS.shuffle, shuffleEnabled);
  updateShuffleUI();
}
function updateShuffleUI() {
  document.getElementById('shuffleBtn').className = 'opt-btn' + (shuffleEnabled ? ' active' : '');
}
function setInsType(type) {
  insType = type;
  localStorage.setItem('insu_type', type);
  LS = getLS();
  allQuestions = insType === 'damage' ? damageQuestions : lifeQuestions;
  updateInsTypeUI();
  renderHome();
}
function updateInsTypeUI() {
  document.getElementById('typeLife').className = 'type-item' + (insType === 'life' ? ' active' : '');
  document.getElementById('typeDamage').className = 'type-item' + (insType === 'damage' ? ' active' : '');
  document.body.classList.toggle('damage', insType === 'damage');
  document.getElementById('headerTitle').textContent = '생명·손해·제3보험 모의고사';
}
function toggleDark() {
  darkMode = !darkMode;
  document.body.classList.toggle('dark', darkMode);
  localStorage.setItem(LS.dark, darkMode);
}
function markComplete() {
  if (!currentQuiz.length) return;
  const cat = currentQuiz[0].category;
  if (!cat) return;
  const comp = getSet(LS.completed);
  if (comp.has(cat)) {
    removeFromSet(LS.completed, cat);
    showToast('완료 해제');
  } else {
    addToSet(LS.completed, cat);
    showToast('학습 완료!');
  }
  updateCompleteBtn();
}
function updateCompleteBtn() {
  const btn = document.getElementById('completeBtn');
  if (!currentQuiz.length) { btn.style.display = 'none'; return; }
  const cat = currentQuiz[0].category;
  // Only show for single-category quizzes (specific mock exams)
  const cats = new Set(currentQuiz.map(q => q.category));
  if (cats.size !== 1 || !cat) { btn.style.display = 'none'; return; }
  btn.style.display = 'inline';
  const comp = getSet(LS.completed);
  if (comp.has(cat)) {
    btn.innerHTML = '&#10003; 완료됨';
    btn.classList.add('complete-btn-active');
  } else {
    btn.innerHTML = '&#10003; 완료';
    btn.classList.remove('complete-btn-active');
  }
}
function toggleBookmark() {
  if (!currentQuiz.length) return;
  const q = currentQuiz[currentIdx];
  const bm = getSet(LS.bookmarks);
  if (bm.has(String(q.id))) {
    removeFromSet(LS.bookmarks, String(q.id));
    showToast('북마크 해제');
  } else {
    addToSet(LS.bookmarks, String(q.id));
    showToast('북마크 추가');
  }
  document.getElementById('bookmarkBtn').innerHTML =
    getSet(LS.bookmarks).has(String(q.id)) ? '&#9733;' : '&#9734;';
}
function resetProgress() {
  if (!confirm('모든 진행 상황을 초기화하시겠습니까?')) return;
  localStorage.removeItem(LS.answered);
  localStorage.removeItem(LS.correct);
  localStorage.removeItem(LS.wrong);
  localStorage.removeItem(LS.bookmarks);
  localStorage.removeItem(LS.completed);
  localStorage.removeItem(LS.lastPos);
  showToast('초기화 완료');
  renderHome();
}

// ===== UTILS =====
function getSet(k) {
  try { return new Set(JSON.parse(localStorage.getItem(k) || '[]')); }
  catch { return new Set(); }
}
function saveSet(k, s) { localStorage.setItem(k, JSON.stringify([...s])); }
function addToSet(k, v) { const s = getSet(k); s.add(v); saveSet(k, s); }
function removeFromSet(k, v) { const s = getSet(k); s.delete(v); saveSet(k, s); }
function shuffle(a) {
  const r = [...a];
  for (let i = r.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [r[i], r[j]] = [r[j], r[i]];
  }
  return r;
}
function esc(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 1500);
}

// Swipe
let tx = 0;
document.addEventListener('touchstart', e => { tx = e.touches[0].clientX; });
document.addEventListener('touchend', e => {
  if (document.getElementById('qScreen').style.display !== 'block') return;
  const d = e.changedTouches[0].clientX - tx;
  if (Math.abs(d) > 80) { d > 0 ? prevQ() : nextQ(); }
});

// Keyboard
document.addEventListener('keydown', e => {
  if (document.getElementById('qScreen').style.display !== 'block') return;
  if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextQ(); }
  if (e.key === 'ArrowLeft') { e.preventDefault(); prevQ(); }
  if (e.key >= '1' && e.key <= '5') {
    const canSelect = mode === 'practice' || (mode === 'study' && !showHighlight);
    if (canSelect) {
      const q = currentQuiz[currentIdx];
      if (q) selectChoice(q.id, parseInt(e.key));
    }
  }
});

init();
</script>
</body>
</html>
